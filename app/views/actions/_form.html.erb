<%= form_for(@action, as: :action_params, remote: true) do |form| %>

  <div class="mb-8">
    <%= component "settings/section_header" do %>
      <%= form.label :title, "Name" %>
    <% end %>
    <%= component "settings/text_input" do |text| %>
      <% text.input do %>
        <%= form.text_field :title %>
      <% end %>
    <% end %>
  </div>
  <div class="mb-8">
    <%= component "settings/section_header" do %>
      <%= form.label :query, "Search Terms" %>
    <% end %>
    <%= component "settings/text_input" do |text| %>
      <% text.input do %>
        <%= form.text_area :query, rows: @action&.query&.length.to_i > 70 ? 3 : 1, placeholder: 'For example: title.exact:"[Sponsor]"', autocorrect: "off", autocapitalize: "off", spellcheck: false %>
      <% end %>
    <% end %>
    <p class="text-sm text-500 mt-2">Actions support the same <a href="/help/search-syntax" target="_blank">syntax as searches</a>.</p>
  </div>

  <% if @user.taggings.present? %>
    <div class="mb-8">
      <%= component "settings/section_header" do %>
        Article is in Tag
      <% end %>
      <ul class="rounded-lg border max-h-[240px] overflow-scroll resize-y">
        <%= form.collection_check_boxes(:tag_ids, @user.feed_tags, :id, :name) do |builder| %>
          <li class="group">
            <%= builder.check_box class: "peer" %>
            <%= builder.label class: "group flex gap-2 items-center py-3 px-4 border-b group-last:border-b-0" do %>
              <%= component "settings/check_box" %>
              <%= builder.text %>
            <% end %>
          </li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="mb-8">
    <%= component "settings/section_header" do %>
      Article is in Feed
    <% end %>

    <div class="flex py-3 px-4 rounded-t-lg border border-b-0">
      <div class="checkbox">
        <%= form.check_box :all_feeds, id: "include_all_feeds", data: {behavior: 'check_feeds'} %>
        <label for="include_all_feeds"><%= svg_tag "icon-check" %>Include all</label>
      </div>
      <%= render "shared/input", class: "ml-auto" do %>
        <input type="text" class="small-field" data-behavior="feed_search" placeholder="Filter" />
      <% end %>
    </div>
    <ul class="rounded-b-lg border max-h-[240px] overflow-scroll resize-y">
      <%= form.collection_check_boxes(:feed_ids, @user.feeds.include_user_title, :string_id, :title) do |builder| %>
        <li class="group">
          <%= builder.check_box feed_checkbox_options(form).merge(class: "peer") %>
          <%= builder.label title: builder.object.feed_url, class: "group flex gap-2 items-center py-3 px-4 border-b group-last:border-b-0" do %>
            <%= component "settings/check_box" %>
            <%= builder.text %>
          <% end %>
        </li>
      <% end %>
    </ul>
  </div>

  <%= component "settings/control_group" do |group| %>
    <% group.header do %>
      Actions
    <% end %>

    <%= form.collection_check_boxes(:actions, Feedbin::Application.config.action_names, :value, :label) do |builder| %>
      <% group.item do %>
        <%= builder.check_box class: "peer" %>
        <%= builder.label class: "group" do %>
          <%= component "settings/switch" do |button| %>
            <% button.title { builder.text } %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>

  <% end %>

  <%= component "settings/control_group" do |group| %>
    <% group.header do %>
      Options
    <% end %>
    <% group.item do %>
      <%= form.check_box :apply_action, class: "peer" %>
      <%= form.label :apply_action, class: "group" do %>
        <%= component "settings/switch" do |button| %>
          <% button.title { "Mark existing matches as read" } %>
        <% end %>
      <% end %>
    <% end %>

  <% end %>

  <div class="description-inset">
    <div class="button-wrap">
      <%= form.submit "Save", name: 'commit', class: "button ui-helper-hidden-accessible", tabindex: "-1" %>
      <% if @action.persisted? %>
        <%= link_to 'Delete', @action, method: :delete, class: 'button button-secondary' , data: { confirm: 'Are you sure you want to delete this action?' } %>
      <% end %>
      <button type="submit" name="preview" class="button button-secondary">View Results</button>
      <button type="submit" name="commit" class="button">Save</button>
    </div>
  </div>

<% end %>